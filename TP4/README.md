## I. DHCP Client

üåû D√©terminer
```
$ ipconfig /all
10.33.79.254
Bail obtenu. . . . . . . . .¬†. . . . . : vendredi 27 octobre 2023 09:05:27
Bail expirant. . . . . . . . .¬†. . . . : samedi 28 octobre 2023 09:05:16
```

üåû Capturer un √©change DHCP

[capture Wireshark](./tp4_dhcp_client.pcapng)

```
$ ipconfig /release
$ ipconfig /renew
```
üåû Analyser la capture Wireshark
```
C'est la trame DHCP offer qui contient les informations propos√©es au client
```

## II. Serveur DHCP

### 1. Topologie
### 2. Tableau d'adressage
### 3. Setup topologie

üåû Preuve de mise en place
```
dhcp ==> $ping youtube.com

64 bytes from par31s18-in-f14.1e100.net (216.58.213.78): icmp_seq=1 ttl=117 time=12.2 ms
```
```
node2 ==> $ping youtube.com

64 bytes from lhr25s01-in-f14.1e100.net (216.58.213.78): icmp_seq=1 ttl=117 time=12.0 ms
```
```
node2 ==> $traceroute 8.8.8.8

1 _gateway (10.4.1.254)  1.019 ms  0.936 ms  1.283 ms 

2 10.0.3.2 (10.0.3.2)  1.249 ms  1.233 ms  1.220 ms
```

## 4. Serveur DHCP
üåû Rendu
```
$ sudo dnf -y install dhcp-server
[brendan@dhcp ~]$ sudo nano /etc/dhcp/dhcpd.conf

[brendan@dhcp ~]$ sudo cat /etc/dhcp/dhcpd.conf
default-lease-time 600;

max-lease-time 7200;

authoritative;

subnet 10.4.1.0 netmask 255.255.255.0 {
        range dynamic-bootp 10.4.1.137 10.4.1.237;
        option routers 10.4.1.254;
}


[brendan@dhcp ~]$ sudo systemctl enable --now dhcpd
[brendan@dhcp ~]$ sudo firewall-cmd --add-service=dhcp
[brendan@dhcp ~]$ sudo firewall-cmd --runtime-to-permanent

[brendan@dhcp ~]$ ll /var/lib/dhcpd
total 8
-rw-r--r--. 1 dhcpd dhcpd   0 Apr 20  2023 dhcpd6.leases
-rw-r--r--. 1 dhcpd dhcpd 276 Nov  8 17:26 dhcpd.leases
-rw-r--r--. 1 dhcpd dhcpd 221 Nov  7 19:30 dhcpd.leases~
```
=> Un systemctl status dhcpd pour voir que le server est actif
```
[brendan@dhcp ~]$ sudo systemctl status dhcpd

‚óè dhcpd.service - DHCPv4 Server Daemon
     Loaded: loaded (/usr/lib/systemd/system/dhcpd.service; enabled; preset: disabled)
     Active: active (running) since Wed 2023-11-08 17:26:05 CET; 3min 40s ago
       Docs: man:dhcpd(8)
             man:dhcpd.conf(5)
   Main PID: 1420 (dhcpd)
     Status: "Dispatching packets..."
      Tasks: 1 (limit: 4672)
     Memory: 4.6M
        CPU: 10ms
     CGroup: /system.slice/dhcpd.service
             ‚îî‚îÄ1420 /usr/sbin/dhcpd -f -cf /etc/dhcp/dhcpd.conf -user dhcpd -group dhcpd --no-pid

Nov 08 17:26:05 dhcp.tp4.b1 dhcpd[1420]: Config file: /etc/dhcp/dhcpd.conf
Nov 08 17:26:05 dhcp.tp4.b1 dhcpd[1420]: Database file: /var/lib/dhcpd/dhcpd.leases
Nov 08 17:26:05 dhcp.tp4.b1 dhcpd[1420]: PID file: /var/run/dhcpd.pid
Nov 08 17:26:05 dhcp.tp4.b1 dhcpd[1420]: Source compiled to use binary-leases
Nov 08 17:26:05 dhcp.tp4.b1 dhcpd[1420]: Wrote 0 leases to leases file.
Nov 08 17:26:05 dhcp.tp4.b1 dhcpd[1420]: Listening on LPF/enp0s3/08:00:27:69:47:4c/10.4.1.0/24
Nov 08 17:26:05 dhcp.tp4.b1 dhcpd[1420]: Sending on   LPF/enp0s3/08:00:27:69:47:4c/10.4.1.0/24
Nov 08 17:26:05 dhcp.tp4.b1 dhcpd[1420]: Sending on   Socket/fallback/fallback-net
Nov 08 17:26:05 dhcp.tp4.b1 dhcpd[1420]: Server starting service.
Nov 08 17:26:05 dhcp.tp4.b1 systemd[1]: Started DHCPv4 Server Daemon.
```

## 5. Client DHCP

üåû Test !
```
[brendan@node1 ~]$ sudo nano /etc/sysconfig/network-scripts/ifcfg-enp0s3

DEVICE=enp0s3

BOOTPROTO=dhcp
ONBOOT=yes
```
üåû Prouvez que
```
[brendan@node1 ~]$ ip a

2: enp0s3: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc fq_codel state UP group default qlen 1000
    link/ether 08:00:27:ed:eb:60 brd ff:ff:ff:ff:ff:ff
    inet 10.4.1.137/24 brd 10.4.1.255 scope global dynamic noprefixroute enp0s3
       valid_lft 589sec preferred_lft 589sec
    inet6 fe80::a00:27ff:feed:eb60/64 scope link
       valid_lft forever preferred_lft forever
```
üåû Bail DHCP serveur

```
[brendan@node1 ~]$ sudo nmcli con show enp0s3

connection.timestamp:  1699471146
soit : mercredi 8 novembre 2023 20:19:06






```

## 6. Options DHCP

üåû Nouvelle conf !
```
[brendan@dhcp ~]$ sudo cat /etc/dhcp/dhcpd.conf

option domain-name-servers 8.8.8.8;

default-lease-time 21600;

max-lease-time 22000;

authoritative;

subnet 10.4.1.0 netmask 255.255.255.0 {
        range dynamic-bootp 10.4.1.137 10.4.1.237;
        option routers 10.4.1.254;
}


[brendan@dhcp ~]$ sudo systemctl restart dhcpd
```

üåû Test !
```
- redemandez une IP avec le client node1.tp4.b1

sudo dhclient -r enp0s3
sudo dhclient enp0s3




- prouvez-que vous avez enregistr√© l'adresse d'un serveur DNS

[brendan@dhcp ~]$ sudo cat /etc/resolv.conf

# Generated by NetworkManager
nameserver 8.8.8.8




- vous avez une nouvelle route par d√©faut qui a √©t√© r√©cup√©r√©e dynamiquement

[brendan@node1 ~]$ ip r s
default via 10.4.1.254 dev enp0s3
default via 10.4.1.254 dev enp0s3 proto dhcp src 10.4.1.137 metric 100
10.4.1.0/24 dev enp0s3 proto kernel scope link src 10.4.1.137 metric 100




- la dur√©e de votre bail DHCP est bien de 6 heures

X




- prouvez que vous avez un acc√®s Internet apr√®s cet √©change DHCP

[brendan@node1 ~]$ ping youtube.com
PING youtube.com (216.58.213.78) 56(84) bytes of data.
64 bytes from par21s18-in-f14.1e100.net (216.58.213.78): icmp_seq=1 ttl=117 time=16.8 ms
64 bytes from lhr25s01-in-f14.1e100.net (216.58.213.78): icmp_seq=2 ttl=117 time=15.7 ms
64 bytes from lhr25s01-in-f78.1e100.net (216.58.213.78): icmp_seq=3 ttl=117 time=14.1 ms
^C
--- youtube.com ping statistics ---
3 packets transmitted, 3 received, 0% packet loss, time 2004ms
rtt min/avg/max/mdev = 14.059/15.540/16.829/1.139 ms
```

üåû Capture Wireshark
```

```